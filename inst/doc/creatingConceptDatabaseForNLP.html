<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Anoop Shah" />

<meta name="date" content="2025-01-28" />

<title>Converting concept database for natural language processing</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Converting concept database for natural language processing</h1>
<h4 class="author">Anoop Shah</h4>
<h4 class="date">2025-01-28</h4>



<div id="converting-concept-database-for-natural-language-processing" class="section level1">
<h1>Converting concept database for natural language processing</h1>
<p>This vignette describes the process for creating a concept database and SNOMED composition lookup for used with named entity recognition.</p>
<p>Before using the code in this vignette, please follow the vignette ‘Using SNOMED dictionaries and codelists’ to download the NHS SNOMED distribution and create a R SNOMED dictionary.</p>
<div id="creating-a-concept-database-for-miade-and-medcat" class="section level2">
<h2>Creating a concept database for MiADE and MedCAT</h2>
<p>MedCAT is a named entity recognition and linking system (NER+L) that uses supervised training on a large corpus of texts to learn the context surrounding definitive mentions of clinical concepts, and uses the context information to disambiguate between different meanings of acronyms or ambiguous terms. This package creates a concept database file in MedCAT format.</p>
<p>MiADE is a natural language processing system for real time extraction of structured information from clinical notes. MiADE incorporates MedCAT NER+L to select SNOMED CT concepts, with pre-procesing (paragraph chunking) and post-processing (conversion of suspected, negated and historic concepts, and filtering). This package creates MiADE lookups for converting suspected, negated and historic concepts to precoordinated SNOMED CT concepts.</p>
<p>To create the MedCAT and MiADE lookups, the steps are:</p>
<ol style="list-style-type: decimal">
<li>Load the SNOMED distribution using loadSNOMED() to create a SNOMED environment.</li>
<li>Use createCDB() to create a CDB environment.</li>
<li>Export the MiADE and MedCAT files using createMiADECDB() (requires SNOMED and CDB environments).</li>
</ol>
</div>
<div id="snomed-ct-concept-decomposition" class="section level2">
<h2>SNOMED CT concept decomposition</h2>
<p>A future version of MiADE will be able to detect diagnosis attributes such as severity and body site separately to the pathology, and then combine them into the most precise and accurate SNOMED CT concept available.</p>
<p>The first stage is to create ‘decompositions’ of SNOMED CT concepts, which uses the SNOMED CT concept model as well as text parsing to decompose a concept into components in a number of different ways. Example code is given below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(Rdiagnosislist)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">require</span>(data.table)</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co"># Use one thread only for CRAN</span></a>
<a class="sourceLine" id="cb1-5" title="5">data.table<span class="op">::</span><span class="kw">setDTthreads</span>(<span class="dt">threads =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co"># Load the SNOMED dictionary (for this example we are using the</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co"># sample included with the package)</span></a>
<a class="sourceLine" id="cb1-9" title="9">SNOMED &lt;-<span class="st"> </span><span class="kw">sampleSNOMED</span>()</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co"># Create a concept database environment</span></a>
<a class="sourceLine" id="cb1-12" title="12">miniCDB &lt;-<span class="st"> </span><span class="kw">createCDB</span>(<span class="dt">SNOMED =</span> SNOMED)</a></code></pre></div>
<pre><code>## Initialising causes.</code></pre>
<pre><code>## Creating transitive closure table.</code></pre>
<pre><code>## Transitive closure table created, 5094 rows.</code></pre>
<pre><code>## Initialising findings and qualifiers.</code></pre>
<pre><code>## Initialising body structures.</code></pre>
<pre><code>## Creating severity and stage lists.</code></pre>
<pre><code>## Creating lists of lateralised structures.</code></pre>
<pre><code>## Creating indices for fast searching</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Create a decomposition</span></a>
<a class="sourceLine" id="cb10-2" title="2">D &lt;-<span class="st"> </span><span class="kw">decompose</span>(<span class="st">&#39;Cor pulmonale&#39;</span>, <span class="dt">CDB =</span> miniCDB, <span class="dt">noisy =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## 
## Decomposing 83291003:  cor pulmonale</code></pre>
<pre><code>## 
## After splitting by parts</code></pre>
<pre><code>##    parttext   rootId  with due_to after without body_site severity stage
##      &lt;char&gt;    &lt;i64&gt; &lt;i64&gt;  &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;
## 1:     &lt;NA&gt; 83291003  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;
##    laterality other_attr            text
##         &lt;i64&gt;     &lt;char&gt;          &lt;char&gt;
## 1:       &lt;NA&gt;       @ @   cor pulmonale</code></pre>
<pre><code>## 
## No valid ancestors, trying morphologies</code></pre>
<pre><code>## 
## No valid morphologies</code></pre>
<pre><code>## 
## Finding ancestors or morphologies</code></pre>
<pre><code>##           parttext   rootId  with due_to after without body_site severity stage
##             &lt;char&gt;    &lt;i64&gt; &lt;i64&gt;  &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;
## 1:  cor pulmonale  83291003  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;
##    laterality other_attr            text   partId
##         &lt;i64&gt;     &lt;char&gt;          &lt;char&gt;    &lt;i64&gt;
## 1:       &lt;NA&gt;       @ @   cor pulmonale  83291003</code></pre>
<pre><code>## 
## Unable to extract body site for this disorder</code></pre>
<pre><code>## 
## Finding causes</code></pre>
<pre><code>##           parttext   rootId  with due_to after without body_site severity stage
##             &lt;char&gt;    &lt;i64&gt; &lt;i64&gt;  &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;
## 1:  cor pulmonale  83291003  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;
##    laterality other_attr            text   partId
##         &lt;i64&gt;     &lt;char&gt;          &lt;char&gt;    &lt;i64&gt;
## 1:       &lt;NA&gt;       @ @   cor pulmonale  83291003</code></pre>
<pre><code>## 
## Finding other attributes</code></pre>
<pre><code>##           parttext   rootId  with due_to after without body_site severity stage
##             &lt;char&gt;    &lt;i64&gt; &lt;i64&gt;  &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;
## 1:  cor pulmonale  83291003  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;
##    laterality other_attr            text   partId other_conceptId
##         &lt;i64&gt;     &lt;char&gt;          &lt;char&gt;    &lt;i64&gt;          &lt;char&gt;
## 1:       &lt;NA&gt;       @ @   cor pulmonale  83291003</code></pre>
<pre><code>## 
## Decomposing 83291003:  right heart failure due to disorder of lung</code></pre>
<pre><code>## Attempting to split by due_to at due to|caused by</code></pre>
<pre><code>## Linked: Disorder of lung (disorder)</code></pre>
<pre><code>## Attempting to split by due_to at due to|caused by</code></pre>
<pre><code>## Linked: Disorder of lung (disorder)</code></pre>
<pre><code>## Successful split by due_to at due to|caused by with SNOMED type as</code></pre>
<pre><code>## Linked: Disorder of lung (disorder)</code></pre>
<pre><code>## Remaining text: right heart failure</code></pre>
<pre><code>## 
## After splitting by parts</code></pre>
<pre><code>##    parttext    rootId  with   due_to after without body_site severity stage
##      &lt;char&gt;     &lt;i64&gt; &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;
## 1:     &lt;NA&gt; 128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;
##    laterality other_attr                  text
##         &lt;i64&gt;     &lt;char&gt;                &lt;char&gt;
## 1:       &lt;NA&gt;     @ @ @   right heart failure</code></pre>
<pre><code>## 
## Finding ancestors or morphologies</code></pre>
<pre><code>##                 parttext    rootId  with   due_to after without body_site
##                   &lt;char&gt;     &lt;i64&gt; &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;
## 1:  right heart failure   84114007  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 2:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 3:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 4:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 5:  right heart failure  367363000  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 6:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
##    severity stage laterality  other_attr                  text    partId
##       &lt;i64&gt; &lt;i64&gt;      &lt;i64&gt;      &lt;char&gt;                &lt;char&gt;     &lt;i64&gt;
## 1:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;  right @ @         heart failure  128404006
## 2:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 3:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 4:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 5:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 6:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006</code></pre>
<pre><code>## 
## Unable to extract body site for this disorder</code></pre>
<pre><code>## 
## Finding causes</code></pre>
<pre><code>##                 parttext    rootId  with   due_to after without body_site
##                   &lt;char&gt;     &lt;i64&gt; &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;
## 1:  right heart failure   84114007  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 2:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 3:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 4:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 5:  right heart failure  367363000  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 6:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
##    severity stage laterality  other_attr                  text    partId
##       &lt;i64&gt; &lt;i64&gt;      &lt;i64&gt;      &lt;char&gt;                &lt;char&gt;     &lt;i64&gt;
## 1:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;  right @ @         heart failure  128404006
## 2:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 3:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 4:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 5:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 6:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006</code></pre>
<pre><code>## 
## Finding other attributes</code></pre>
<pre><code>##                 parttext    rootId  with   due_to after without body_site
##                   &lt;char&gt;     &lt;i64&gt; &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;
## 1:  right heart failure   84114007  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 2:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 3:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 4:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 5:  right heart failure  367363000  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 6:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
##    severity stage laterality  other_attr                  text    partId
##       &lt;i64&gt; &lt;i64&gt;      &lt;i64&gt;      &lt;char&gt;                &lt;char&gt;     &lt;i64&gt;
## 1:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;  right @ @         heart failure  128404006
## 2:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 3:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 4:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 5:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 6:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
##    other_conceptId
##             &lt;char&gt;
## 1:           right
## 2:                
## 3:                
## 4:                
## 5:                
## 6:</code></pre>
<pre><code>## 
## Decomposing 83291003:  right heart failure due to pulmonary disease</code></pre>
<pre><code>## Attempting to split by due_to at due to|caused by</code></pre>
<pre><code>## Linked: Disorder of lung (disorder)</code></pre>
<pre><code>## Attempting to split by due_to at due to|caused by</code></pre>
<pre><code>## Linked: Disorder of lung (disorder)</code></pre>
<pre><code>## Successful split by due_to at due to|caused by with SNOMED type as</code></pre>
<pre><code>## Linked: Disorder of lung (disorder)</code></pre>
<pre><code>## Remaining text: right heart failure</code></pre>
<pre><code>## 
## After splitting by parts</code></pre>
<pre><code>##    parttext    rootId  with   due_to after without body_site severity stage
##      &lt;char&gt;     &lt;i64&gt; &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;
## 1:     &lt;NA&gt; 128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;
##    laterality other_attr                  text
##         &lt;i64&gt;     &lt;char&gt;                &lt;char&gt;
## 1:       &lt;NA&gt;     @ @ @   right heart failure</code></pre>
<pre><code>## 
## Finding ancestors or morphologies</code></pre>
<pre><code>##                 parttext    rootId  with   due_to after without body_site
##                   &lt;char&gt;     &lt;i64&gt; &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;
## 1:  right heart failure   84114007  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 2:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 3:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 4:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 5:  right heart failure  367363000  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 6:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
##    severity stage laterality  other_attr                  text    partId
##       &lt;i64&gt; &lt;i64&gt;      &lt;i64&gt;      &lt;char&gt;                &lt;char&gt;     &lt;i64&gt;
## 1:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;  right @ @         heart failure  128404006
## 2:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 3:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 4:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 5:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 6:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006</code></pre>
<pre><code>## 
## Unable to extract body site for this disorder</code></pre>
<pre><code>## 
## Finding causes</code></pre>
<pre><code>##                 parttext    rootId  with   due_to after without body_site
##                   &lt;char&gt;     &lt;i64&gt; &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;
## 1:  right heart failure   84114007  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 2:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 3:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 4:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 5:  right heart failure  367363000  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 6:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
##    severity stage laterality  other_attr                  text    partId
##       &lt;i64&gt; &lt;i64&gt;      &lt;i64&gt;      &lt;char&gt;                &lt;char&gt;     &lt;i64&gt;
## 1:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;  right @ @         heart failure  128404006
## 2:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 3:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 4:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 5:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 6:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006</code></pre>
<pre><code>## 
## Finding other attributes</code></pre>
<pre><code>##                 parttext    rootId  with   due_to after without body_site
##                   &lt;char&gt;     &lt;i64&gt; &lt;i64&gt;    &lt;i64&gt; &lt;i64&gt;   &lt;i64&gt;     &lt;i64&gt;
## 1:  right heart failure   84114007  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 2:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 3:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 4:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 5:  right heart failure  367363000  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
## 6:  right heart failure  128404006  &lt;NA&gt; 19829001  &lt;NA&gt;    &lt;NA&gt;      &lt;NA&gt;
##    severity stage laterality  other_attr                  text    partId
##       &lt;i64&gt; &lt;i64&gt;      &lt;i64&gt;      &lt;char&gt;                &lt;char&gt;     &lt;i64&gt;
## 1:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;  right @ @         heart failure  128404006
## 2:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 3:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 4:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 5:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
## 6:     &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;      @ @ @   right heart failure  128404006
##    other_conceptId
##             &lt;char&gt;
## 1:           right
## 2:                
## 3:                
## 4:                
## 5:                
## 6:</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="kw">print</span>(D)</a></code></pre></div>
<pre><code>## 
## --------------------------------------------------------------------------------
## 83291003 | Cor pulmonale (disorder)
## --------------------------------------------------------------------------------
## Root : 128404006 | Right heart failure (disorder)
## - Due to : 19829001 | Disorder of lung (disorder)
## 
## --------------------------------------------------------------------------------
## 83291003 | Cor pulmonale (disorder)
## --------------------------------------------------------------------------------
## Root : 367363000 | Right ventricular failure (disorder)
## - Due to : 19829001 | Disorder of lung (disorder)</code></pre>
<p>To create the composition lookups, the steps are:</p>
<ol style="list-style-type: decimal">
<li>Create the SNOMED and CDB objects as per above.</li>
<li>Select the set of SNOMED CT concepts for which to create decompositions.</li>
<li>Use the batchDecompose() function (note: this can take a long time to run), in our test it took about 10 days on a standard PC to decompose all SNOMED CT findings.</li>
<li>Use addComposeLookupToCDB() lookup to convert the decompositions into a lookup table which is optimised for fast search, and add it to the CDB.</li>
</ol>
<p>The compose lookup table can now be used to refine SNOMED CT concepts using compose(), which selects a more specific concept based on supplied attributes.</p>
<p>Example code:</p>
<pre><code># Create SNOMED and CDB
SNOMED &lt;- loadSNOMED(path_to_snomed)
CDB &lt;- createCDB(SNOMED)

# Select SNOMED CT concepts to decompose
disorders &lt;- descendants(&#39;Disorder&#39;, SNOMED = SNOMED)

# Batch decomposition
batchDecompose(disorders, CDB = CDB, SNOMED = SNOMED,
  output_filename = &#39;path_to_decompositions.csv&#39;)

# Create composition lookup
CDB &lt;- addComposeLookupToCDB(&#39;path_to_decompositions.csv&#39;,
  CDB = CDB, SNOMED = SNOMED)

# Test the decomoposition table to refine a SNOMED CT concept
compose(conceptId = as.SNOMEDconcept(&#39;Fracture&#39;), CDB = CDB,
  attributes_conceptIds = as.SNOMEDconcept(c(&#39;Open&#39;, &#39;Femur&#39;)),
  due_to_conceptIds = bit64::integer64(0),
  without_conceptIds = bit64::integer64(0),
  with_conceptIds = bit64::integer64(0),
  SNOMED = SNOMED)</code></pre>
<p>The following attributes can be supplied to compose():</p>
<ul>
<li>attributes_conceptIds = body site, severity, stage, laterality, adjectives (qualifiers)</li>
<li>due_to_conceptIds = conditions that cause the root condition (e.g. AF due to hyperthyroidism)</li>
<li>without_conceptIds = conditions that are absent or negated (e.g. blister without infection)</li>
<li>with_conceptIds = conditions that are also present (e.g. hypertension with albuminuria)</li>
</ul>
</div>
<div id="more-information" class="section level2">
<h2>More information</h2>
<p>For more information about SNOMED CT, visit the SNOMED CT international website: <a href="https://www.snomed.org/" class="uri">https://www.snomed.org/</a></p>
<p>SNOMED CT (UK edition) can be downloaded from the NHS Digital site: <a href="https://isd.digital.nhs.uk/trud/user/guest/group/0/home" class="uri">https://isd.digital.nhs.uk/trud/user/guest/group/0/home</a></p>
<p>The NHS Digital terminology browser can be used to search for terms interactively: <a href="https://termbrowser.nhs.uk/" class="uri">https://termbrowser.nhs.uk/</a></p>
<p>For more information about MiADE, visit <a href="https://www.ucl.ac.uk/health-informatics/research/miade/miade-software-and-availability" class="uri">https://www.ucl.ac.uk/health-informatics/research/miade/miade-software-and-availability</a></p>
<p>For more information about MedCAT, visit <a href="https://github.com/CogStack/MedCAT" class="uri">https://github.com/CogStack/MedCAT</a></p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
